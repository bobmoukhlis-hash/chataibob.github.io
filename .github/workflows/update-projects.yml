name: ğŸš€ Aggiorna lista progetti automaticamente

on:
  schedule:
    - cron: "0 9 * * *" # ogni giorno alle 09:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: ğŸ§  Genera projects.json
        run: |
          pip install requests
          python <<'EOF'
          import requests, json

          USER = "bobmouklhis-hash"
          url = f"https://api.github.com/users/{USER}/repos?per_page=100"
          repos = requests.get(url).json()

          data = []
          for r in repos:
              if not r.get("private") and r.get("name") != f"{USER}.github.io":
                  data.append({
                      "name": r["name"],
                      "url": r.get("homepage") or r.get("html_url")
                  })

          with open("projects.json", "w", encoding="utf-8") as f:
              json.dump(data, f, indent=2, ensure_ascii=False)
          EOF

      - name: ğŸ’¾ Commit e push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add projects.json
          git commit -m "Aggiornamento automatico lista progetti" || echo "Nessuna modifica"
          git push
