
name: ğŸš€ Aggiorna lista progetti automaticamente

on:
  schedule:
    - cron: "0 */6 * * *"  # Ogni 6 ore
  workflow_dispatch:       # Puoi anche avviarlo manualmente

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Clona il repository del sito
        uses: actions/checkout@v3

      - name: ğŸ Imposta Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Installa dipendenze
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: ğŸ“„ Crea o aggiorna il file projects.json
        run: |
          echo "import json, requests" > script.py
          echo "USER = 'bobmoukhlis-hash'" >> script.py
          echo "repos = requests.get(f'https://api.github.com/users/{USER}/repos?per_page=100').json()" >> script.py
          echo "data = []" >> script.py
          echo "for repo in repos:" >> script.py
          echo "    if not repo['private'] and repo['name'] != f'{USER}.github.io':" >> script.py
          echo "        data.append({'name': repo['name'], 'url': repo['homepage'] or repo['html_url']})" >> script.py
          echo "with open('projects.json', 'w', encoding='utf-8') as f:" >> script.py
          echo "    json.dump(data, f, indent=2, ensure_ascii=False)" >> script.py
          python script.py

      - name: ğŸ’¾ Commit e push dei cambiamenti
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add projects.json
          git commit -m "ğŸ” Aggiornamento automatico lista progetti" || echo "Nessun cambiamento"
          git push
