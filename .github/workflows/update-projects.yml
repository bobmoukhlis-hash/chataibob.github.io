name: ğŸš€ Aggiorna lista progetti automaticamente

on:
  schedule:
    - cron: "0 9 * * *"  # Esegue ogni giorno alle 09:00 UTC
  workflow_dispatch:     # Puoi anche avviarlo manualmente

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Clona il repository del sito
        uses: actions/checkout@v3

      - name: ğŸ Imposta Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: ğŸ“„ Crea o aggiorna il file projects.json
        run: |
          python - <<EOF
          import json, requests
          USER = "bobmoukhlis-hash"
          repos = requests.get(f"https://api.github.com/users/{USER}/repos?per_page=100").json()
          data = []
          for repo in repos:
              if not repo["private"] and repo["name"] != f"{USER}.github.io":
                  data.append({
                      "name": repo["name"],
                      "url": repo["homepage"] or repo["html_url"]
                  })
          with open("projects.json", "w", encoding="utf-8") as f:
              json.dump(data, f, indent=2, ensure_ascii=False)
          EOF

      - name: ğŸ’¾ Commit e push dei cambiamenti
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add projects.json
          git commit -m "ğŸ” Aggiornamento automatico lista progetti" || echo "Nessun cambiamento"
          git push
