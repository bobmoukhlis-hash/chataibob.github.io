<script>
  // ðŸ”— URL DEL WORKER (GIUSTO)
  const GROQ_PROXY_URL = "https://shy-poetry-9c52.bouabidmoukhlis.workers.dev";

  async function inviaMessaggio() {
    const testo = document.querySelector("textarea").value;
    const fileInput = document.querySelector('input[type="file"]');
    const output = document.getElementById("output");

    output.innerText = "â³ Attendi...";

    let messages = [];

    // ðŸ“ Testo
    if (testo && testo.trim() !== "") {
      messages.push({
        role: "user",
        content: testo
      });
    }

    // ðŸ“· Immagine (se presente)
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const base64 = await toBase64(file);

      messages = [{
        role: "user",
        content: [
          { type: "text", text: testo || "Analizza questa immagine" },
          {
            type: "image_url",
            image_url: { url: base64 }
          }
        ]
      }];
    }

    try {
      const res = await fetch(GROQ_PROXY_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: fileInput.files.length > 0
            ? "llama-3.2-11b-vision-preview"
            : "llama-3.3-70b-versatile",
          messages: messages
        })
      });

      const data = await res.json();

      output.innerText =
        data.text ||
        data.choices?.[0]?.message?.content ||
        JSON.stringify(data, null, 2);

    } catch (e) {
      output.innerText = "âŒ Errore: " + e.message;
    }
  }

  // ðŸ”„ Converti file in Base64
  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }
</script><footer style="text-align:center;margin-top:30px;opacity:0.6;">
  Â© <span id="year"></span> ChatAI Bob PRO
</footer>

<script>
  document.getElementById("year").innerText = new Date().getFullYear();
</script>
