<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ¤– ChatAI Bob PRO 2025 (No Worker)</title>
  <style>
    body{margin:0;font-family:system-ui,Arial;background:#070b12;color:#e8f1ff}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:#0b1220;border:1px solid #13223d;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:22px}
    .muted{opacity:.8;font-size:13px}
    .grid{display:grid;gap:12px}
    @media (min-width:860px){.grid{grid-template-columns:1.2fr .8fr}}
    textarea,select,button,input{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #1a2f55;background:#071022;color:#e8f1ff;padding:12px}
    textarea{min-height:110px;resize:vertical}
    button{cursor:pointer;background:linear-gradient(90deg,#00e5ff,#3b82f6);border:0;font-weight:700}
    button.alt{background:#0b1220;border:1px solid #1a2f55}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .out{white-space:pre-wrap;background:#071022;border:1px solid #1a2f55;border-radius:12px;padding:12px;min-height:140px}
    .media{display:grid;gap:10px}
    img{width:100%;border-radius:12px;border:1px solid #1a2f55;background:#000}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #1a2f55;background:#071022;font-size:12px;opacity:.9}
    .ok{color:#7CFFB2}
    .warn{color:#FFD36E}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ¤– ChatAI Bob PRO 2025</h1>
      <div class="muted">Versione 100% GitHub Pages â€” <b>senza Worker</b> e <b>senza Python</b></div>
      <div style="margin-top:10px" class="pill ok">âœ… Microfono + Voce + Immagini (Pollinations)</div>
      <div style="margin-top:8px" class="pill warn">âš ï¸ Chat Groq disattivata (senza backend non Ã¨ sicuro)</div>
    </div>

    <div style="height:12px"></div>

    <div class="grid">
      <div class="card">
        <label class="muted">âœï¸ Scrivi un messaggio</label>
        <textarea id="prompt" placeholder="es. crea un esempio di codice html oppure genera unâ€™immagine di un cane"></textarea>

        <div style="height:10px"></div>

        <div class="row">
          <div>
            <label class="muted">Lingua</label>
            <select id="lang">
              <option value="it" selected>it</option>
              <option value="en">en</option>
              <option value="fr">fr</option>
              <option value="es">es</option>
            </select>
          </div>
          <div>
            <label class="muted">Tipo</label>
            <select id="tipo">
              <option value="Demo Chat" selected>Demo Chat (offline)</option>
              <option value="Immagine">Immagine</option>
              <option value="Video">Video (GIF fake)</option>
            </select>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <button id="micBtn" class="alt">ğŸ¤ Microfono</button>
          <button id="sendBtn">ğŸš€ Invia</button>
        </div>

        <div style="height:10px"></div>
        <label class="muted">ğŸ’¬ Output</label>
        <div id="output" class="out"></div>

        <div style="height:10px"></div>
        <button id="speakBtn" class="alt">ğŸ”Š Leggi con voce</button>

        <div class="muted" style="margin-top:10px">
          ğŸ”’ Nota: Senza Worker/Server non si puÃ² usare Groq in modo sicuro su GitHub Pages (la chiave verrebbe esposta).
        </div>
      </div>

      <div class="card">
        <div class="media">
          <div>
            <label class="muted">ğŸ–¼ï¸ Immagine</label>
            <img id="img" alt="" style="display:none" />
          </div>
          <div>
            <label class="muted">ğŸ¥ GIF</label>
            <img id="gif" alt="" style="display:none" />
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // prompt helper
  function cleanPrompt(p){ return (p||"").trim(); }

  // Pollinations
  function pollinationsUrl(text){
    return "https://image.pollinations.ai/prompt/" + encodeURIComponent(text);
  }
  function fakeGifUrl(text){
    return pollinationsUrl((text||"cinematic scene") + " cinematic scene");
  }

  // TTS
  function speak(text, lang){
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang || "it-IT";
      window.speechSynthesis.speak(u);
    }catch(e){
      alert("TTS non disponibile: " + e);
    }
  }

  // STT (microfono)
  let recognizing = false;
  let recognition = null;

  function uiLangTag(code){
    return code === "it" ? "it-IT"
      : code === "en" ? "en-US"
      : code === "fr" ? "fr-FR"
      : "es-ES";
  }

  function setupMic(lang){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR) return null;
    const r = new SR();
    r.continuous = false;
    r.interimResults = true;
    r.lang = lang;
    return r;
  }

  // UI
  const promptEl = document.getElementById("prompt");
  const langEl = document.getElementById("lang");
  const tipoEl = document.getElementById("tipo");
  const out = document.getElementById("output");
  const img = document.getElementById("img");
  const gif = document.getElementById("gif");
  const micBtn = document.getElementById("micBtn");
  const sendBtn = document.getElementById("sendBtn");
  const speakBtn = document.getElementById("speakBtn");

  let lastText = "";

  micBtn.addEventListener("click", () => {
    const l = uiLangTag(langEl.value);
    if(!recognition) recognition = setupMic(l);
    if(!recognition){
      out.textContent = "âŒ Microfono non supportato su questo browser.";
      return;
    }
    recognition.lang = l;

    if(recognizing){
      recognition.stop();
      recognizing = false;
      micBtn.textContent = "ğŸ¤ Microfono";
      return;
    }

    recognizing = true;
    micBtn.textContent = "â¹ Stop";
    recognition.start();

    recognition.onresult = (e) => {
      let transcript = "";
      for (let i = e.resultIndex; i < e.results.length; i++){
        transcript += e.results[i][0].transcript;
      }
      promptEl.value = transcript.trim();
    };

    recognition.onend = () => {
      recognizing = false;
      micBtn.textContent = "ğŸ¤ Microfono";
    };
  });

  function demoChatAnswer(userText){
    const t = (userText||"").toLowerCase();
    if(!t) return "âš ï¸ Scrivi qualcosa.";
    if(t.includes("html")) return "Ecco un esempio HTML:\n\n<!doctype html>\n<html>\n  <body>\n    <h1>Ciao!</h1>\n  </body>\n</html>";
    if(t.includes("css")) return "Esempio CSS:\n\nbody { background:#000; color:#fff; }";
    if(t.includes("js") || t.includes("javascript")) return "Esempio JS:\n\nconsole.log('Ciao dal JavaScript');";
    return "Demo offline âœ…\n\nHai scritto:\n" + userText + "\n\nPer risposte AI vere serve un server/proxy (altrimenti la chiave Groq si vede).";
  }

  sendBtn.addEventListener("click", () => {
    const testo = cleanPrompt(promptEl.value);
    const tipo = tipoEl.value;

    img.style.display="none";
    gif.style.display="none";
    out.textContent = "";
    lastText = "";

    if(tipo === "Immagine"){
      const url = pollinationsUrl(testo || "cute robot assistant");
      img.src = url;
      img.style.display = "block";
      out.textContent = "ğŸ–¼ï¸ Immagine generata!";
      lastText = "Immagine generata";
      return;
    }

    if(tipo === "Video"){
      const url = fakeGifUrl(testo || "cinematic scene");
      gif.src = url;
      gif.style.display = "block";
      out.textContent = "ğŸ¥ GIF (fake) generata!";
      lastText = "GIF generata";
      return;
    }

    const ans = demoChatAnswer(testo);
    out.textContent = ans;
    lastText = ans;
  });

  speakBtn.addEventListener("click", () => {
    if(!lastText){
      out.textContent = out.textContent || "âš ï¸ Nessun testo da leggere.";
      return;
    }
    speak(lastText, uiLangTag(langEl.value));
  });
</script>
</body>
</html>
