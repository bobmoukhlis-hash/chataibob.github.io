<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatAI Bob FREE</title>

<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#e5e7eb}
.top{padding:12px;background:#020617;display:flex;justify-content:space-between}
.dot{width:8px;height:8px;border-radius:50%;background:#999;display:inline-block}
.dot.ok{background:#34d399}
.dot.bad{background:#fb7185}
.chat{padding:12px;max-width:720px;margin:auto}
.msg{margin:8px 0;padding:10px;border-radius:10px;white-space:pre-wrap}
.user{background:#38bdf822}
.ai{background:#111827}
textarea,input,button{width:100%;margin:6px 0;padding:10px}
button{background:#38bdf8;border:0;font-weight:bold;border-radius:8px}
#messages{max-height:55vh;overflow-y:auto}
.small{font-size:12px;opacity:.8}
</style>
</head>

<body>

<div class="top">
  <div>ü§ñ ChatAI Bob FREE</div>
  <div>
    <span class="dot" id="statusDot"></span>
    <span id="statusText">Backend: controllo‚Ä¶</span>
  </div>
</div>

<div class="chat">

<input id="apiBase" placeholder="https://chatai-bob-backend.onrender.com">
<button id="saveApi">Salva backend URL</button>
<p class="small" id="netHint"></p>

<div id="messages"></div>

<textarea id="input" placeholder="Scrivi un messaggio..."></textarea>
<button id="sendBtn">Invia</button>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

let API_BASE=localStorage.getItem("API_BASE")||"";
const $=id=>document.getElementById(id);

$("apiBase").value=API_BASE;

function setStatus(ok,text){
  $("statusDot").className="dot "+(ok?"ok":"bad");
  $("statusText").textContent=text;
}

async function checkHealth(){
  if(!API_BASE)return;
  try{
    const r=await fetch(API_BASE+"/health");
    const d=await r.json();
    if(d.status==="ok"){
      setStatus(true,"Backend: online");
      $("netHint").textContent="OK: /health ‚Üí JSON ok";
    }else throw 0;
  }catch{
    setStatus(false,"Backend: offline");
  }
}

function addMessage(role,text){
  const div=document.createElement("div");
  div.className="msg "+role;
  div.textContent=text;
  $("messages").appendChild(div);
  $("messages").scrollTop=$("messages").scrollHeight;
}

$("saveApi").onclick=()=>{
  API_BASE=$("apiBase").value.trim().replace(/\/+$/,"");
  localStorage.setItem("API_BASE",API_BASE);
  checkHealth();
};

$("sendBtn").onclick=async()=>{
  const text=$("input").value.trim();
  if(!text)return;
  addMessage("user",text);
  $("input").value="";

  try{
    const r=await fetch(API_BASE+"/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    const d=await r.json();
    addMessage("ai",d.text||"Errore");
  }catch{
    addMessage("ai","‚ùå Errore di connessione");
  }
};

checkHealth();

// messaggio iniziale
addMessage("ai","Ciao üëã Sono ChatAI Bob.\nScrivi qualcosa per iniziare!");

});
</script>

</body>
</html>
