<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatAI Bob PRO 2026 â€” Global</title>

<style>
body{
  font-family: system-ui, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:12px;
}
h2{text-align:center;}
select,textarea,button,input{
  width:100%;
  max-width:600px;
  margin:8px auto;
  display:block;
  font-size:16px;
}
textarea{height:90px;padding:10px;}
button{
  padding:12px;
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:6px;
}
#output,#imgResult{
  max-width:600px;
  margin:12px auto;
  padding:10px;
  background:#fff;
  border-radius:6px;
  white-space:pre-wrap;
}
footer{text-align:center;opacity:.6;margin-top:30px;}
</style>
</head>

<body>

<h2>ğŸ‡²ğŸ‡¦ ChatAI Bob PRO 2026 â€” Global</h2>

<!-- ğŸ“· IMAGE -->
<input type="file" id="imgInput" accept="image/*">
<button onclick="analyzeImage()">ğŸ–¼ï¸ Analizza foto</button>
<div id="imgResult">ğŸ“· Nessuna immagine analizzata.</div>

<!-- ğŸŒ LANGUAGE -->
<select id="langMode">
<option value="auto">ğŸŒ AUTO (consigliato)</option>
<option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
<option value="en">ğŸ‡¬ğŸ‡§ English</option>
<option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
<option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
<option value="ary">ğŸ‡²ğŸ‡¦ Darija</option>
</select>

<!-- ğŸ’¬ CHAT -->
<textarea id="userText" placeholder="Scrivi come vuoiâ€¦"></textarea>
<button id="sendBtn" onclick="sendMessage()">ğŸš€ Invia</button>
<div id="output">â³ Pronto.</div>

<footer>Â© 2025 ChatAI Bob PRO</footer>

<script>
const GROQ_PROXY_URL = "https://groq-proxy-worker.bouabidmoukhlis.workers.dev";

/* ========= IMAGE ANALYSIS ========= */
async function analyzeImage(){
  const input = document.getElementById("imgInput");
  const out = document.getElementById("imgResult");

  if(!input.files || !input.files[0]){
    out.textContent = "âŒ Nessun file selezionato.";
    return;
  }

  out.textContent = "â³ Analisi in corsoâ€¦";

  try{
    const base64 = await toBase64(input.files[0]);

    const res = await fetch(GROQ_PROXY_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        model:"llama-3.2-90b-vision-preview",
        messages:[{
          role:"user",
          content:[
            {type:"text", text:"Descrivi questa immagine in modo chiaro."},
            {type:"image_url", image_url:{url:base64}}
          ]
        }],
        max_tokens:300
      })
    });

    const data = await res.json();
    out.textContent = data?.choices?.[0]?.message?.content || "âŒ Nessuna risposta.";

  }catch(e){
    out.textContent = "âŒ Errore: " + e.message;
  }
}

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

/* ========= CHAT ========= */
function looksArabic(t){return /[\u0600-\u06FF]/.test(t);}
function looksDarija(t){
  return ["Ø´Ù†Ùˆ","ÙˆØ§Ø´","Ø¨ØºÙŠØª","Ø¯Ø§Ø¨Ø§","ÙÙŠÙ†","Ù‡Ø§Ø¯","Ø¯ÙŠØ§Ù„"].some(w=>t.includes(w));
}

function systemInstruction(text){
  const mode=document.getElementById("langMode").value;
  if(mode!=="auto") return `Reply ONLY in ${mode}.`;
  if(looksDarija(text)) return "Reply in Moroccan Darija.";
  if(looksArabic(text)) return "Reply in Arabic.";
  return "Reply in the same language as the user.";
}

async function sendMessage(){
  const text=document.getElementById("userText").value.trim();
  const out=document.getElementById("output");
  if(!text){out.textContent="âš ï¸ Scrivi qualcosa.";return;}

  out.textContent="â³ Attendiâ€¦";

  try{
    const r=await fetch(GROQ_PROXY_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        model:"llama-3.3-70b-versatile",
        messages:[
          {role:"system",content:systemInstruction(text)},
          {role:"user",content:text}
        ],
        max_tokens:600
      })
    });

    const d=await r.json();
    out.textContent=d?.choices?.[0]?.message?.content || "âŒ Nessuna risposta.";
  }catch(e){
    out.textContent="âŒ Errore: "+e.message;
  }
}
</script>

</body>
</html>
